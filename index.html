<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>How many Chinese People in Each County?</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        
        .container {
            width: 100%;
            height: 100vh;
            position: relative;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }

        /* Tooltip styling */
        .tooltip {
            position: absolute;
            text-align: center;
            padding: 12px;
            background: rgba(51, 51, 51, 0.9);
            color: #fff;
            border-radius: 8px;
            border: 1px solid #fff;
            pointer-events: none;
            opacity: 0;
            font-size: 14px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            max-width: 200px;
            z-index: 10;
        }

        .county {
            transition: fill 0.2s;
        }

        .county:hover {
            stroke: #000;
            stroke-width: 0.5px;
        }
    </style>
</head>
<body>
    <h1>Chinese Population Proportion in Each County</h1>
    <div class="container"></div>
    <div id="tooltip" class="tooltip"></div>

    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>
    <script>
        // Create SVG
        const svg = d3.select(".container")
            .append("svg")
            .attr("width", "100%")
            .attr("height", "100%")
            .attr("viewBox", "0 0 975 610");

        const tooltip = d3.select("#tooltip");

        // Load data
        Promise.all([
            d3.json("counties-10m.json"),
            d3.csv("chinese.csv", d => ({
                id: d.GEO_ID.replace("0500000US", ""),
                name: d.NAME,
                proportion: +d.proportion.replace("%", "") / 100
            }))
        ]).then(([topology, census]) => {
            // Create lookup object for census data
            const proportions = new Map(census.map(d => [d.id, d]));

            // Create color scale
            const color = d3.scaleSequential(d3.interpolateGreens)
                .domain([0, 0.01]);

            // Setup projection
            const projection = d3.geoAlbersUsa()
                .scale(1300)
                .translate([487.5, 305]);

            const path = d3.geoPath().projection(projection);

            // Draw counties
            svg.append("g")
                .selectAll("path")
                .data(topojson.feature(topology, topology.objects.counties).features)
                .join("path")
                .attr("class", "county")
                .attr("d", path)
                .attr("fill", d => {
                    const countyData = proportions.get(d.id);
                    return countyData ? color(countyData.proportion) : "#eee";
                })
                .on("mouseover", function(d) {
                    const countyData = proportions.get(d.id);
                    if (countyData) {
                        tooltip
                            .style("opacity", 1)
                            .html(`
                                <strong>${countyData.name}</strong><br>
                                Chinese Population: ${(countyData.proportion * 100).toFixed(2)}%
                            `);
                    }
                })
                .on("mousemove", function(d) {
                    tooltip
                        .style("left", (d3.event.pageX + 15) + "px")
                        .style("top", (d3.event.pageY - 28) + "px");
                })
                .on("mouseout", function() {
                    tooltip.style("opacity", 0);
                });

            // Draw state boundaries
            svg.append("path")
                .datum(topojson.mesh(topology, topology.objects.states, (a, b) => a !== b))
                .attr("fill", "none")
                .attr("stroke", "#333")
                .attr("stroke-width", "0.5px")
                .attr("d", path);

            // Draw nation boundary
            svg.append("path")
                .datum(topojson.feature(topology, topology.objects.nation))
                .attr("fill", "none")
                .attr("stroke", "#333")
                .attr("stroke-width", "1px")
                .attr("d", path);

        }).catch(error => {
            console.error("Error loading data:", error);
        });
    </script>
</body>
</html>